<?xml version="1.0" encoding="UTF-8"?>

<UTQLPatternTemplates xmlns='http://ar.in.tum.de/ubitrack/utql'
                      xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
                      xmlns:xi='http://www.w3.org/2001/XInclude'
                      xmlns:h="http://www.w3.org/1999/xhtml"
                      xsi:schemaLocation='http://ar.in.tum.de/ubitrack/utql ../../../schema/utql_templates.xsd'>
    
	<!-- new (experimental) patterns start here -->
	
	<Pattern name="MarkerTrackerCorner" displayName="Experimental: Optical Square-Marker Tracker (2D Corners)">
        <Description>
            <h:p>Detects markers and computes the 2D-position of the four corners in the image.</h:p>
        </Description>
        <Output>
			<Node name="ImagePlane" displayName="Image Plane"/>
            <Node name="Marker" displayName="Marker">
                <Attribute name="markerId" displayName="Marker ID" default="0x272" xsi:type="StringAttributeDeclarationType">
                    <Description>
                        <h:p>Marker ID in Hex, e.g. 0x272. Attention: This ID is used as the module key for the marker tracker algorithm. It must be unique, otherwise deceptive error messages will occur.</h:p>
                    </Description>
                </Attribute>
                <Attribute name="markerSize" displayName="Marker Size" default="0.06" xsi:type="DoubleAttributeDeclarationType">
                    <Description>
                        <h:p>Marker size, expected as meter, e.g. 0.06.</h:p>
                    </Description>
                </Attribute>
            </Node>
            <Edge name="Corners" source="ImagePlane" destination="Marker" displayName="Marker Corners">
                <Description>
                    <h:p>Image coordinates of marker corners. Order of the corners is clockwise, starting in the left lower corner of the marker.</h:p>
                </Description>
                <Attribute name="type" value="2DPositionList" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
        </Output>
        <DataflowConfiguration>
            <UbitrackLib class="MarkerTracker"/>
        </DataflowConfiguration>
    </Pattern>
	
	<Pattern name="MarkerTrackerImage" displayName="Experimental: Optical Square-Marker Tracker Input Image">
        <Description>
            <h:p>This edge can be used to specify the image to which the marker tracker should be applied to.</h:p>
        </Description>
        <Input>
            <Node name="Camera" displayName="Camera"/>
            <Node name="ImagePlane" displayName="Image Plane"/>
            <Edge name="Image" displayName="Input Image" source="Camera" destination="ImagePlane" >
                <Description>
                    <h:p>Greyscale input image of the corresponding marker tracker module.</h:p>
                </Description>
                <Predicate>type=='Image'&amp;&amp;mode=='push'</Predicate>
            </Edge>
        </Input>
		<DataflowConfiguration>
            <UbitrackLib class="MarkerTracker"/>
        </DataflowConfiguration>
    </Pattern>
	
	<Pattern name="MarkerTrackerDebug" displayName="Experimental: Optical Square-Marker Tracker Debug Image">
        <Description>
            <h:p>This edge provides the debug image of the corresponding marker tracker module, when attached to a marker tracker camera node.</h:p>
        </Description>
        <Output>
            <Node name="Camera" displayName="Camera"/>
            <Node name="ImagePlane" displayName="Image Plane"/>
            <Edge name="DebugImage" displayName="Debug Image" source="Camera" destination="ImagePlane" >
                <Description>
                    <h:p>Debug image of the corresponding marker tracker module.</h:p>
                </Description>
                <Attribute name="type" value="Image" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
        </Output>
		<DataflowConfiguration>
            <UbitrackLib class="MarkerTracker"/>
        </DataflowConfiguration>
    </Pattern>
    
	<Pattern name="MarkerTrackerMatrix" displayName="Experimental: Optical Square-Marker Tracker Intrinsic Matrix">
        <Description>
            <h:p>Specifies the camera's 3x3 intrinsic matrix that should be applied to the marker tracker module.
			This intrinsic matrix is valid for all attached markers connected to the same camera node.
            </h:p>
        </Description>
        <Input>
            <Node name="Camera" displayName="Camera"/>
            <Node name="ImagePlane" displayName="Image Plane"/>
            <Edge name="CameraIntrinsics" displayName="3x3 Matrix" source="ImagePlane" destination="Camera" >
                <Description>
                    <h:p>Camera 3x3 intrinsic matrix.</h:p>
                </Description>
                <Predicate>type=='3x3Matrix'&amp;&amp;mode=='pull'</Predicate>
            </Edge>
        </Input>
		<DataflowConfiguration>
            <UbitrackLib class="MarkerTracker"/>
        </DataflowConfiguration>
    </Pattern>
	
	
	<!-- pattern should be added soon, stay tuned:
	Pattern name="MarkerTrackerCameraIntrinsics" displayName="Experimental: Optical Square-Marker Tracker Camera Intrinsic Parameters">
        <Description>
            <h:p>Specifies the intrinsics camera parameters that should be applied to the marker tracker module.
			These intrinsic parameters are valid for all attached markers connected to the same camera node.
            </h:p>
        </Description>
        <Input>
            <Node name="Camera" displayName="Camera"/>
            <Node name="ImagePlane" displayName="Image Plane"/>
            <Edge name="CameraIntrinsics" displayName="Camera Intrinsics" source="ImagePlane" destination="Camera" >
                <Description>
                    <h:p>Camera intrinsic parameters.</h:p>
                </Description>
                <Predicate>type=='3x3Matrix'&amp;&amp;mode=='pull'</Predicate>
            </Edge>
        </Input>
		<DataflowConfiguration>
            <UbitrackLib class="MarkerTracker"/>
        </DataflowConfiguration>
    </Pattern-->
	
	<!-- new (experimental) patterns end here -->
    
    <!-- Attribute declarations -->
	
	
	
	
    <GlobalNodeAttributeDeclarations>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/1/1)"/>
    </GlobalNodeAttributeDeclarations>
    
    <GlobalEdgeAttributeDeclarations>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/1)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/2)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/3)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/4)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/5)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/6)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/7)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/8)"/>
    </GlobalEdgeAttributeDeclarations>
    
    <GlobalDataflowAttributeDeclarations>
        <!-- Unfortunately, the xpointer used in Xinclude is currently restricted to the element scheme and absolute element indices in Xerces (and thus XMLBeans) -->
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/1)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/2)"/>
		<xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/3)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/4)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/5)"/>
    </GlobalDataflowAttributeDeclarations>
    
</UTQLPatternTemplates>
